<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="portal_my_home_my_job_card" name="Portal My Home Technician Job Cards"
        inherit_id="portal.portal_my_home" priority="40">
        <xpath expr="//div[@id='portal_common_category']" position="inside">
            <div t-if="request.env.user.has_group('base.group_user')"
                class="o_portal_index_card col-md-6 order-2">
                <a href="/my/technician-jobcards" title="My Job Cards"
                    class="d-flex gap-2 gap-md-3 py-3 pe-2 px-md-3 h-100 rounded text-decoration-none bg-100">
                    <div class="o_portal_icon d-block align-self-start">
                        <img src="/web/static/img/folder.svg" loading="lazy" alt="Job Card Icon" />
                    </div>
                    <div>
                        <div class="mt-0 mb-1 fs-5 fw-normal lh-1 d-flex gap-2">
                            <span>My Job Cards</span>
                        </div>
                        <div class="opacity-75">
                            View your assigned service job cards.
                        </div>
                    </div>
                </a>
            </div>
        </xpath>
    </template>

    <template id="my_job_card_list_template" name="My Job Cards List">
        <t t-call="portal.portal_layout">
            <h3 class="mb-4">My Job Cards</h3>

            <div t-if="not job_cards" class="alert alert-info text-center mt-3">
                You have no assigned job cards yet.
            </div>
            <div t-else="" class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Job Card Number</th>
                            <th>Booking Date</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Plate Number</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="job_cards" t-as="job_card">
                            <tr>
                                <td>
                                    <a t-att-href="job_card.get_portal_url()">
                                        <t t-esc="job_card.name" />
                                    </a>
                                </td>
                                <td>
                                    <t t-esc="job_card.plan_service_date"
                                        t-options='{"widget": "date"}' />
                                </td>
                                <td>
                                    <t t-esc="job_card.customer_name.name" />
                                </td>
                                <td>
                                    <t t-esc="job_card.vehicle_brand.name" />
                                    <t t-esc="job_card.vehicle_model.name" />
                                </td>
                                <td>
                                    <t t-esc="job_card.plat_number" />
                                </td>
                                <td>
                                    <span
                                        t-attf-class="badge bg-#{job_card.state == 'completed' and 'success' or job_card.state == 'in_progress' and 'info' or job_card.state == 'assigned' and 'warning' or job_card.state == 'cancelled' and 'danger' or job_card.state == 'booked' and 'primary' or 'light'}">
                                        <t t-esc="job_card.state" />
                                    </span>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>

            <div t-if="pager" class="o_portal_pager text-center">
                <t t-call="portal.pager" />
            </div>
        </t>
    </template>

    <template id="my_job_card_detail_template" name="Job Card Details">
        <t t-call="portal.portal_layout">
            <div class="card o_portal_my_doc shadow-sm">
                <div class="card-body p-3 p-lg-4">

                    <div
                        class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3">
                        <h2 class="mb-2"> Job Card: <span t-field="job_card.name" />
                        </h2>

                        <div class="o_portal_return_buy">
                            <a t-if="back_url" t-att-href="back_url" class="btn btn-secondary">
                                <i class="fa fa-chevron-left me-1" /> Back to My Job Cards </a>
                            <a
                                t-attf-href="/web#id=#{job_card.id}&amp;model=service.booking&amp;view_type=form"
                                class="btn btn-primary ms-2" target="_blank">
                                <i class="fa fa-pencil me-1" /> Edit in Odoo </a>
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-12 col-lg-6 mb-3">
                            <h4 class="my-4">Booking Information</h4>
                            <div class="bg-body">
                                <p class="mb-3">
                                    <strong>Job Card Number:</strong>
                                    <span t-field="job_card.name" />
                                </p>
                                <p class="mb-3">
                                    <strong>Status:</strong>
                                    <span
                                        t-attf-class="badge rounded-pill text-bg-#{job_card.state == 'completed' and 'success' or job_card.state == 'in_progress' and 'info' or job_card.state == 'assigned' and 'warning' or job_card.state == 'cancelled' and 'danger' or 'primary'}">
                                        <span t-field="job_card.state" />
                                    </span>
                                </p>
                                <p class="mb-3">
                                    <strong>Planned Service Date:</strong>
                                    <span t-field="job_card.plan_service_date"
                                        t-options='{"widget": "date"}' />
                                </p>
                                <p class="mb-3">
                                    <strong>Service Type:</strong>
                                    <span t-field="job_card.service_type.name" />
                                </p>
                                <p class="mb-2">
                                    <strong>Complaints:</strong>
                                    <span t-field="job_card.complaint_issue" />
                                </p>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6 mb-3">
                            <h4 class="my-4">Vehicle Information</h4>
                            <div class="bg-body">
                                <p class="mb-3">
                                    <strong>Customer:</strong>
                                    <span t-field="job_card.customer_name.name" />
                                </p>
                                <p class="mb-3">
                                    <strong>Brand:</strong>
                                    <span t-field="job_card.vehicle_brand.name" />
                                </p>
                                <p class="mb-3">
                                    <strong>Model:</strong>
                                    <span t-field="job_card.vehicle_model.name" />
                                </p>
                                <p class="mb-3">
                                    <strong>Plate Number:</strong>
                                    <span t-field="job_card.plat_number" />
                                </p>
                                <p class="mb-3">
                                    <strong>Year:</strong>
                                    <span t-field="job_card.vehicle_year_manufacture" />
                                </p>
                                <p class="mb-2">
                                    <strong>Kilometers:</strong>
                                    <span t-field="job_card.kilometers" />
                                </p>
                            </div>
                        </div>
                    </div>

                    <div t-if="job_card.inspection_checklist_line_ids" class="mb-0">
                        <h4 class="mb-3">Inspection Checklist</h4>
                        <ul class="list-group">
                            <t t-foreach="job_card.inspection_checklist_line_ids"
                                t-as="checklist_line">
                                <t t-if="checklist_line.checklist_ok">
                                    <li
                                        class="list-group-item d-flex justify-content-between align-items-center">
                                        <span t-field="checklist_line.inspection_type_id.name" />
                                        <span
                                            t-attf-class="badge rounded-pill text-bg-#{checklist_line.checklist_ok and 'success' or 'danger'}">
                                            <t t-if="checklist_line.checklist_ok">OK</t>
                                            <t t-else="">N/A</t>
                                        </span>
                                    </li>
                                </t>
                            </t>
                        </ul>
                    </div>

                </div>
            </div>
        </t>
    </template>

    <template id="portal_my_job_card_breadcrumbs" inherit_id="portal.portal_breadcrumbs"
        priority="40">
        <xpath expr="//ol[@class='o_portal_submenu breadcrumb mb-0 flex-grow-1 px-0']"
            position="inside">
            <li
                t-if="page_name == 'my_job_card' or page_name == 'my_job_card_detail'"
                class="breadcrumb-item">
                <a t-att-href="default_url">My Job Cards</a>
            </li>
            <li t-if="page_name == 'my_job_card_detail'" class="breadcrumb-item active">
                <span t-field="job_card.name" />
            </li>
        </xpath>
    </template>
</odoo>